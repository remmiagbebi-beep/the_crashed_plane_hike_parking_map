<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Parking Locations</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet" />

  <style>
    html, body {
      margin: 0;
      height: 100%;
      width: 100%;
      background: #000;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    #map { position: absolute; inset: 0; }

    /* Popup styling */
    .mapboxgl-popup-content {
      padding: 15px 15px 10px 15px; /* reduced bottom padding */
      border-radius: 20px;
    }

    .mapboxgl-popup-tip {
      display: none;
    }

    /* Directions link */
    .mapboxgl-popup-content a {
      display: inline-flex;
      align-items: center;
      gap: 4px; /* reduced by 2px */
      font-size: 12px;
      font-weight: 600; /* bold */
      color: #3899EC;
      text-decoration: none;
      outline: none !important;
      box-shadow: none !important;
      border: none !important;
    }

    /* Marker icon before Directions */
    .directions-icon {
      width: 14px;
      height: 14px;
      background-color: #3899EC;
      mask: url("icons/marker-svgrepo-com.svg") no-repeat center;
      -webkit-mask: url("icons/marker-svgrepo-com.svg") no-repeat center;
      mask-size: contain;
      -webkit-mask-size: contain;
      display: inline-block;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>
  <script>
    mapboxgl.accessToken = "pk.eyJ1IjoicmVtbWlhZ2JlYmkiLCJhIjoiY21odHRrYTQzMTk0bjJqcjE1b2xhZ2FraSJ9.nTCz33gX0gQt3T4A6VD0oQ";

    const carParks = [
      { name: "Main Parking",  coords: [-1.741681169995867, 53.400323549479204] },
      { name: "Alternative 1", coords: [-1.7415555555555555, 53.398] },
      { name: "Alternative 2", coords: [-1.7405602541940284, 53.3975013703475] },
      { name: "Alternative 3", coords: [-1.7396111111111112, 53.396166666666666] },
      { name: "Alternative 4", coords: [-1.7304308779114999, 53.39311015688274] }
    ];

    const map = new mapboxgl.Map({
      container: "map",
      style: "mapbox://styles/mapbox/satellite-streets-v12",
      center: carParks[0].coords,
      zoom: 15
    });

    map.addControl(new mapboxgl.FullscreenControl(), "top-right");
    map.addControl(new mapboxgl.NavigationControl(), "bottom-right");

    function popupHtml(name, coords) {
      return `
        <div style="font-size:13px;line-height:1.3">
          <div style="margin-bottom:6px;font-weight:600">${name}</div>
          <a target="_blank" rel="noopener"
             href="https://www.google.com/maps/dir/?api=1&destination=${coords[1]},${coords[0]}">
            <span class="directions-icon"></span>
            Directions
          </a>
        </div>
      `;
    }

    let openPopup = null;

    carParks.forEach((p) => {
      const popup = new mapboxgl.Popup({
        offset: 16,
        closeButton: false,
        closeOnClick: false
      }).setHTML(popupHtml(p.name, p.coords));

      const marker = new mapboxgl.Marker({
        color: "#EC2629",
        scale: 0.85
      })
        .setLngLat(p.coords)
        .addTo(map);

      marker.getElement().addEventListener("click", () => {
        if (openPopup) openPopup.remove();
        popup.setLngLat(p.coords).addTo(map);
        openPopup = popup;
        map.flyTo({ center: p.coords, zoom: 15, essential: true });
      });
    });

    map.on("load", () => {
      const first = carParks[0];
      const firstPopup = new mapboxgl.Popup({
        offset: 16,
        closeButton: false,
        closeOnClick: false
      }).setHTML(popupHtml(first.name, first.coords))
        .setLngLat(first.coords)
        .addTo(map);

      openPopup = firstPopup;
      map.flyTo({ center: first.coords, zoom: 15, essential: true });
    });
  </script>
</body>
</html>
